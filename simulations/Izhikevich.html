<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Izhikevich Neuron Simulator (Minimal Test)</title>
<style>
  body { font-family: sans-serif; background:#111; color:#eee; }
  .controls { margin-bottom:10px; }
  canvas { background:#000; width:100%; height:300px; }
</style>
</head>

<body>
<h2>Izhikevich Neuron Simulator â€” Minimal Working Version</h2>

<div class="controls">
  I (current): <input id="I" type="range" min="0" max="20" step="1" value="10">
  <span id="Ival">10</span><br>

  dt: <input id="dt" type="number" value="0.1" step="0.01"><br><br>

  <button id="reset">Reset</button>
  <button id="pause">Pause</button>
</div>

<canvas id="c" width="800" height="300"></canvas>

<script>
// ==================== GLOBALS ======================
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
let running = true;

// Izhikevich parameters (regular spiking)
let a = 0.02, b = 0.2, c = -65, d = 8;

// state variables
let v, u, t;
let trace = [];

// ==================== RESET ========================
function reset() {
  v = c;         // membrane voltage start
  u = b * v;     // recovery variable
  t = 0;
  trace = new Array(canvas.width).fill(v);
  draw();
}
reset();

// ==================== UPDATE =======================
function step() {
  if (!running) return requestAnimationFrame(step);

  let I = parseFloat(document.getElementById("I").value);
  let dt = parseFloat(document.getElementById("dt").value);

  // Izhikevich equations
  let dv = (0.04*v*v + 5*v + 140 - u + I) * dt;
  let du = (a*(b*v - u)) * dt;

  v += dv;
  u += du;

  if (v >= 30) {
    v = 30;      // spike peak
    draw();      // draw spike
    v = c;       // reset
    u += d;
  }

  trace.shift();
  trace.push(v);
  t += dt;

  draw();
  requestAnimationFrame(step);
}

// ==================== DRAW =========================
function draw() {
  ctx.fillStyle = "#000";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.strokeStyle = "#0f0";
  ctx.beginPath();
  trace.forEach((val, x) => {
    const y = 150 - (val + 65)*2;
    if (x === 0) ctx.moveTo(x,y);
    else ctx.lineTo(x,y);
  });
  ctx.stroke();
}

// ==================== UI ===========================
document.getElementById("I").oninput = e =>
  document.getElementById("Ival").textContent = e.target.value;

document.getElementById("reset").onclick = () => reset();
document.getElementById("pause").onclick = () => running = !running;

// ==================== START ========================
requestAnimationFrame(step);
</script>

</body>
</html>
