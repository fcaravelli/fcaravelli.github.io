<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Izhikevich Neuron Simulator</title>
<style>
  body { font-family: sans-serif; background:#111; color:#eee; margin:20px; }
  .controls { margin-bottom:12px; }
  canvas { background:#000; width:100%; height:300px; margin-top:12px; }
  input[type="number"] { width:60px; }
</style>
</head>

<body>
<h2>Izhikevich Neuron Simulator</h2>

<div class="controls">

  Mode:
  <select id="mode">
    <option value="rs">Regular Spiking</option>
    <option value="fs">Fast Spiking</option>
    <option value="ch">Chattering</option>
    <option value="ib">Intrinsically Bursting</option>
    <option value="rz">Resonator</option>
    <option value="custom">Custom</option>
  </select>
  <br><br>

  I: 
  <input id="I" type="range" min="0" max="20" step="1" value="10">
  <span id="Ival">10</span>
  <br><br>

  dt: <input id="dt" type="number" value="0.1" step="0.01">
  <br><br>

  <b>Parameters:</b><br>
  a: <input id="a" type="number" step="0.01" value="0.02">
  b: <input id="b" type="number" step="0.01" value="0.20">
  v_reset: <input id="v_reset" type="number" step="1" value="-65">
  d: <input id="d" type="number" step="0.5" value="8">
  <br><br>

  <button id="reset">Reset</button>
  <button id="pause">Pause</button>

</div>

<canvas id="traceCanvas" width="800" height="300"></canvas>

<script>
// =====================================================
const canvas = document.getElementById("traceCanvas");
const ctx = canvas.getContext("2d");
let running = true;
let trace = [];

// Fixed presets — renamed "c" → "v_reset"
const PRESETS = {
  rs:{a:0.02,b:0.2,v_reset:-65,d:8},
  fs:{a:0.1,b:0.2,v_reset:-65,d:2},
  ch:{a:0.02,b:0.2,v_reset:-50,d:2},
  ib:{a:0.01,b:0.2,v_reset:-55,d:4},
  rz:{a:0.1,b:0.26,v_reset:-60,d:0},
};

let v, u, t;

// =====================================================
function reset(applyPreset = true) {
  const mode = document.getElementById("mode").value;

  if (mode !== "custom" && applyPreset) {
    const p = PRESETS[mode];
    document.getElementById("a").value = p.a;
    document.getElementById("b").value = p.b;
    document.getElementById("v_reset").value = p.v_reset;
    document.getElementById("d").value = p.d;
  }

  const a = parseFloat(document.getElementById("a").value);
  const b = parseFloat(document.getElementById("b").value);
  const v_reset = parseFloat(document.getElementById("v_reset").value);

  v = v_reset;
  u = b * v;
  t = 0;

  trace = new Array(canvas.width).fill(v);
  draw();
}

reset();

// =====================================================
function stepNeuron() {
  if (!running) {
    requestAnimationFrame(stepNeuron);
    return;
  }

  const I = +document.getElementById("I").value;
  const dt = +document.getElementById("dt").value;

  const a = +document.getElementById("a").value;
  const b = +document.getElementById("b").value;
  const v_reset = +document.getElementById("v_reset").value;
  const d = +document.getElementById("d").value;

  let dv = (0.04*v*v + 5*v + 140 - u + I) * dt;
  let du = (a*(b*v - u)) * dt;

  v += dv;
  u += du;

  if (v >= 30) {
    v = 30;
    draw();
    v = v_reset;
    u += d;
  }

  trace.shift();
  trace.push(v);
  t += dt;

  draw();
  requestAnimationFrame(stepNeuron);
}

// =====================================================
function draw() {
  ctx.fillStyle = "#000";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.strokeStyle = "#0f0";
  ctx.beginPath();

  trace.forEach((val,x)=>{
    const y = 150 - (val + 65) * 2;
    if (x===0) ctx.moveTo(x,y);
    else ctx.lineTo(x,y);
  });

  ctx.stroke();
}

// =====================================================
document.getElementById("pause").onclick = () => {
  running = !running;
  document.getElementById("pause").textContent = running ? "Pause" : "Resume";
};

document.getElementById("reset").onclick = () => reset(true);

document.getElementById("I").oninput = e =>
  document.getElementById("Ival").textContent = e.target.value;

document.getElementById("mode").onchange = () => reset(true);

["a","b","v_reset","d"].forEach(id=>{
  document.getElementById(id).oninput = ()=>{
    document.getElementById("mode").value = "custom";
    reset(false);
  };
});

requestAnimationFrame(stepNeuron);
</script>

</body>
</html>
